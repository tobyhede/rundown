# Review Agent 1 Findings

## Components Found in Turboshovel

### Parser Package (`packages/parser/`)
**Source Files (9):**
1. ast.ts
2. frontmatter.ts
3. helpers.ts
4. index.ts (exports)
5. parser.ts
6. schemas.ts
7. step-id.ts
8. types.ts
9. validator.ts

**Test Files (6):**
1. conformance.test.ts
2. frontmatter.test.ts
3. helpers.test.ts
4. parser.test.ts
5. schemas.test.ts
6. validator.test.ts

**Fixture Files (36):**
- 17 valid conformance fixtures (conformance/valid/)
- 16 invalid conformance fixtures (conformance/invalid/)
- Plus 3 additional dynamic/navigation fixtures

### Shared/Core Package (`packages/shared/`)
**Source Files (19):**
1. cli/index.ts
2. cli/output.ts
3. cli/render.ts
4. cli/types.ts
5. config.ts (turboshovel-specific, marked for removal)
6. errors.ts
7. index.ts (exports)
8. logger.ts
9. schemas.ts
10. types.ts
11. utils.ts
12. workflow/compiler.ts
13. workflow/executor.ts
14. workflow/index.ts
15. workflow/renderer/renderer.ts
16. workflow/state.ts
17. workflow/step-id.ts
18. workflow/transition-handler.ts
19. workflow/types.ts

**Test Files (10):**
1. cli/output.test.ts
2. cli/render.test.ts
3. schemas.test.ts
4. workflow/compiler.test.ts
5. workflow/executor.test.ts
6. workflow/renderer.test.ts
7. workflow/state.test.ts
8. workflow/step-id.test.ts
9. workflow/transition-handler.test.ts
10. workflow/types.test.ts

### CLI Package (`packages/cli/`)
**Source Files (20):**
1. cli.ts (main entry point)
2. commands/check.ts
3. commands/complete.ts
4. commands/echo.ts
5. commands/fail.ts
6. commands/gate.ts
7. commands/goto.ts
8. commands/ls.ts
9. commands/pass.ts
10. commands/pop.ts
11. commands/prune.ts
12. commands/run.ts
13. commands/stash.ts
14. commands/status.ts
15. commands/stop.ts
16. helpers/context.ts
17. helpers/resolve-workflow.ts
18. helpers/wrapper.ts
19. services/discovery.ts
20. services/execution.ts

**Test Files (19):**
Including commands tests, integration tests, helpers tests, services tests

**Fixture Files (7):**
- fail-goto.runbook.md
- goto.runbook.md
- retry.runbook.md
- simple.runbook.md
- substeps.runbook.md
- with-commands.runbook.md
- with-failing-command.runbook.md

### Documentation (`docs/`)
1. FORMAT.md
2. PATTERNS.md
3. RUNDOWN.md
4. SPEC.md
5. end-to-end-test.md (placeholder)

## Components Covered by Plan

The plan explicitly covers:
- Parser: 9 source files ✓, 6 test files ✓, 32 fixture files (actual: 36) ⚠
- Core/Shared: 16 source files (actual: 19) ⚠, 10 test files ✓
- CLI: 18 source files (actual: 20) ⚠, 19 test files + fixtures ✓
- Documentation: 4 main docs ✓

## MISSING from Plan

### 1. Parser Fixtures - DISCREPANCY
**Plan says:** 32 fixture files
**Actual count:** 36 fixture files
**Missing:** 4 additional fixtures (dynamic-navigation.runbook.md, dynamic-step-next.runbook.md, dynamic-substep-transitions.runbook.md, goto-dynamic-substep-from-static.runbook.md)

### 2. Shared/Core Source Files - DISCREPANCY
**Plan says:** 16 source files
**Actual count:** 19 source files
**Missing files in plan:**
1. workflow/renderer/renderer.ts (subdirectory not mentioned)
2. workflow/transition-handler.ts (not listed)
3. workflow/index.ts (workflow package exports)

### 3. CLI Source Files - DISCREPANCY
**Plan says:** 18 source files
**Actual count:** 20 source files
**Missing files in plan:**
1. services/discovery.ts
2. services/execution.ts
3. helpers/wrapper.ts

### 4. CLI Commands NOT mentioned in plan
- `echo.ts` - Test utility command (not addressed)
- `prune.ts` - Cleanup command (not addressed)
- Plan only explicitly removes `gate.ts`

### 5. Documentation - MISSING
- `docs/plans/e2e-test.md` not addressed

## ISSUES Found

### Critical Issues:

1. **Incomplete File Count in Plan**
   - Parser fixtures: Plan says 32, actual is 36
   - Shared source files: Plan says 16, actual is 19
   - CLI source files: Plan says 18, actual is 20
   - **Impact:** Copy commands will work (cp -r), but counts are misleading

2. **Services Subdirectory Not Addressed**
   - CLI package has services/ subdirectory with discovery.ts and execution.ts
   - Not mentioned in plan's import update steps

3. **CLI Commands Not Properly Categorized**
   - `echo` and `prune` commands exist but aren't documented for extraction
   - Unclear whether they should be extracted, renamed, or removed

## VERDICT

**INCOMPLETE** - The extraction plan has significant gaps:

### Primary Reasons:

1. **File count inaccuracies** - Plan undercounts actual components:
   - 4 additional parser fixtures
   - 3 additional shared source files
   - 2 additional CLI service files

2. **Unaddressed CLI commands** - `echo` and `prune` commands not addressed

3. **Import updates missing** - Services subdirectory needs import path updates

### Recommendation:
Plan is ~85% complete but needs refinement before execution.
