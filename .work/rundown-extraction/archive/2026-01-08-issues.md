# Rundown Extraction Plan - Issues Report

**Date:** 2026-01-08
**Verdict:** INCOMPLETE (~85%)

---

## Critical (Must Fix Before Extraction)

### 1. Parser Tests Failing
**Severity:** CRITICAL
**Confidence:** VALIDATED

Parser tests fail with missing schema exports:
```
FAIL __tests__/schemas.test.ts
SyntaxError: The requested module '../src/schemas.js' does not provide an export named 'TransitionObjectSchema'

Test Suites: 4 failed, 2 passed, 6 total
Tests:       5 failed, 107 passed, 112 total
```

**Impact:** Pre-flight check requirement violated. Extraction cannot proceed.
**Fix:** Export `TransitionObjectSchema` from `packages/parser/src/schemas.ts`

---

## Medium (Should Fix)

### 2. Services Subdirectory Missing from Import Updates
**Severity:** Medium
**Confidence:** HIGH (2/2)

CLI package has `services/discovery.ts` and `services/execution.ts` not mentioned in sed import update commands.

**Impact:** Potential build failures - imports won't be updated.
**Fix:** Add to Task 4:
```bash
find packages/cli/src/services -name "*.ts" -exec sed -i '' 's/@turboshovel\/shared/@rundown\/core/g' {} \;
```

### 3. Test Utilities Incomplete Replacement
**Severity:** Medium
**Confidence:** VALIDATED

`test-utils.ts` line 28 has hardcoded `tsv-test-` prefix not in plan:
```typescript
const tempDir = await mkdtemp(join(tmpdir(), 'tsv-test-'));
```

**Impact:** Test temp directories will still use `tsv-` prefix.
**Fix:** Add to Task 4, Step 9:
```
- Change `tsv-test-` to `rd-test-` (line 28)
```

### 4. Jest Configuration Module Mapping
**Severity:** Medium
**Confidence:** VALIDATED

`shared/jest.config.js` line 10:
```javascript
'^@turboshovel/parser$': '<rootDir>/../parser/src/index.ts',
```

**Impact:** Tests will fail to resolve parser package.
**Fix:** Add new step to Task 3:
```
Edit packages/core/jest.config.js:
- Change `@turboshovel/parser` to `@rundown/parser`
```

### 5. Test Count Mismatch
**Severity:** Medium
**Confidence:** VALIDATED

Plan verification checklist has wrong counts:
| Package | Plan Says | Actual |
|---------|-----------|--------|
| Parser | 130 | 112 |
| Core | 120 | 145 |
| CLI | 198 | 205 |
| **Total** | **448** | **462** |

**Impact:** Verification checklist will show false failures/passes.
**Fix:** Update Task 7 verification checklist with correct counts.

### 6. CLI Commands Not Addressed: echo and prune
**Severity:** Medium
**Confidence:** HIGH (2/2)

Commands exist but plan is silent on them:
- `echo.ts` - Test utility command
- `prune.ts` - Cleanup command

Plan only explicitly removes `gate.ts`.

**Impact:** Unclear intent - will be extracted but may have stale references.
**Fix:** Add explicit decision to plan:
- Keep and rename `tsv echo` → `rd echo`
- Keep and rename `tsv prune` → `rd prune`

---

## Low (Nice to Fix)

### 7. File Count Discrepancies
**Severity:** Low
**Confidence:** HIGH (2/2)

Plan undercounts files:
- Parser fixtures: 32 → 36 actual
- Shared source: 16 → 19 actual
- CLI source: 18 → 20 actual

**Impact:** Misleading but `cp -r` will copy all files.
**Fix:** Update file counts in plan for accuracy.

### 8. Configuration Files Not Mentioned
**Severity:** Low
**Confidence:** VALIDATED

`packages/cli/.c8rc.json` exists but not mentioned.

**Impact:** Will be copied by `cp -r`, but not documented.
**Fix:** Add to extraction checklist.

### 9. Documentation Plans Subdirectory
**Severity:** Low
**Confidence:** VALIDATED

`docs/plans/e2e-test.md` exists but not addressed.

**Impact:** May or may not need extraction.
**Fix:** Decide: include in docs copy or exclude.

### 10. Nested Renderer Directory
**Severity:** Low (Non-blocking)
**Confidence:** VALIDATED

`workflow/renderer/renderer.ts` is nested deeper than plan describes.

**Impact:** None - `cp -r` handles this.
**Fix:** Documentation only.

---

## User Decision Required

### 11. Plugin Architecture Ambiguity
**Severity:** User Decision
**Confidence:** UNCERTAIN

Turboshovel is currently a Claude Code plugin. Unclear if rundown should be:
- Standalone library (current plan assumption)
- Also a plugin

**Fix:** Clarify architecture intent.

---

## Summary

| Severity | Count |
|----------|-------|
| Critical | 1 |
| Medium | 5 |
| Low | 4 |
| User Decision | 1 |
| **Total** | **11** |

**Recommendation:** Fix critical issue (parser tests) and medium issues before executing extraction plan.
