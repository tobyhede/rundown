# Code Review - 2026-01-08

## Status: BLOCKED

## BLOCKING (Must Fix Before Merge)

**Incomplete turboshovel reference replacement in core package:**
- Description: Several turboshovel references remain in the extracted core package that were not properly cleaned during the extraction. These include old package comments, interface names, and test fixture paths.
- Location: Multiple files (see below)
- Action: Replace all remaining turboshovel references:

  1. `/Users/tobyhede/psrc/rundown/packages/core/src/index.ts:1` - Comment says `@turboshovel/shared`
     - Change to: `// @rundown/core - Core workflow and configuration library`

  2. `/Users/tobyhede/psrc/rundown/packages/core/src/types.ts:65` - Interface named `TurboshovelConfig`
     - Change to: `RundownConfig`

  3. `/Users/tobyhede/psrc/rundown/packages/core/__tests__/cli/output.test.ts:54,58,65,74` - Test fixtures use `.claude/turboshovel/runbooks/` path
     - Change to: `.claude/rundown/workflows/`

**Duplicate import statement in test file:**
- Description: The output.test.ts file has a duplicate import line for `printWorkflowStopped` and `printWorkflowStoppedAtStep`.
- Location: `/Users/tobyhede/psrc/rundown/packages/core/__tests__/cli/output.test.ts:10-11`
- Action: Remove the duplicate import on line 11.

**CLI package build failure:**
- Description: The CLI package build fails because the src directory is empty (cleaned in Task 1 but not yet populated - Task 4 of the plan). This is expected per the plan, but the build script tries to compile an empty package.
- Location: `/Users/tobyhede/psrc/rundown/packages/cli/`
- Action: Either add a placeholder file or skip CLI build until Task 4 completes. For now, this blocks the full build from succeeding.


## NON-BLOCKING (May Be Deferred)

**Stale package comment header in types.ts:**
- Description: Comment at top of types.ts says `packages/shared/src/types.ts` which is the old turboshovel path.
- Location: `/Users/tobyhede/psrc/rundown/packages/core/src/types.ts:1`
- Action: Update to `// packages/core/src/types.ts` or remove the path comment.

**Stale package comment header in logger.ts:**
- Description: Comment at top of logger.ts says `packages/shared/src/logger.ts` which is the old turboshovel path.
- Location: `/Users/tobyhede/psrc/rundown/packages/core/src/logger.ts:1`
- Action: Update to `// packages/core/src/logger.ts` or remove the path comment.

**CLI dist directory contains stale turboshovel references:**
- Description: The `/Users/tobyhede/psrc/rundown/packages/cli/dist/` directory contains compiled JS files with turboshovel references (e.g., `execution.js:161`). These are stale artifacts from before the clean slate.
- Location: `/Users/tobyhede/psrc/rundown/packages/cli/dist/`
- Action: Delete the entire `packages/cli/dist/` directory since CLI will be rebuilt from scratch in Task 4.


## Checklist

**Security & Correctness:**
- [x] No security vulnerabilities (SQL injection, XSS, CSRF, exposed secrets)
- [x] No insecure dependencies or deprecated cryptographic functions
- [x] No critical logic bugs (meets acceptance criteria)
- [x] No race conditions, deadlocks, or data races
- [x] No unhandled errors, rejected promises, or panics
- [x] No breaking API or schema changes without migration plan

**Testing:**
- [x] All tests passing (unit, integration, property-based where applicable) - Parser: 126 tests, Core: 145 tests
- [x] New logic has corresponding tests
- [x] Tests cover edge cases and error conditions
- [x] Tests verify behavior (not implementation details)
- [ ] Property-based tests for mathematical/algorithmic code with invariants - N/A for extraction
- [x] Tests are isolated (independent, don't rely on other tests)
- [x] Test names are clear and use structured arrange-act-assert patterns

**Architecture:**
- [x] Single Responsibility Principle (functions/files have one clear purpose)
- [x] No non-trivial duplication (logic that if changed in one place would need changing elsewhere)
- [x] Clean separation of concerns (business logic separate from data marshalling)
- [x] No leaky abstractions (internal details not exposed)
- [x] No over-engineering (YAGNI - implement only current requirements)
- [x] No tight coupling (excessive dependencies between modules)
- [x] Proper encapsulation (internal details not exposed across boundaries)
- [x] Modules can be understood and tested in isolation

**Error Handling:**
- [x] No swallowed exceptions or silent failures
- [x] Error messages provide sufficient context for debugging
- [x] Fail-fast on invariants where appropriate

**Code Quality:**
- [x] Simple, not clever (straightforward solutions over complex ones)
- [x] Clear, descriptive naming (variables, functions, classes)
- [x] Type safety maintained
- [x] Follows language idioms and project patterns consistently
- [x] No magic numbers or hardcoded strings (use named constants)
- [x] Consistent approaches when similar functionality exists elsewhere
- [x] Comments explain "why" not "what" (code should be self-documenting)
- [x] Rationale provided for non-obvious design decisions
- [x] Doc comments for public APIs

**Process:**
- [x] No obvious performance issues (N+1 queries, inefficient algorithms on hot paths)
- [x] ALL linter warnings addressed by fixing root cause (disable/allow/ignore ONLY when unavoidable)
- [ ] Requirements met exactly (no scope creep) - Incomplete: turboshovel references remain
- [x] No unnecessary reinvention (appropriate use of existing libraries/patterns)


## Next Steps

1. Address BLOCKING issues (if any)
2. Consider NON-BLOCKING suggestions
3. Ready to merge when status is APPROVED or APPROVED WITH SUGGESTIONS


---

## Verification Details

**Commits reviewed:**
- `fee9cb6` - chore: clean slate for fresh extraction
- `f058c1b` - feat(parser): extract parser package from turboshovel
- `6695e0a` - feat(core): extract core package from turboshovel shared

**Commands executed:**
```bash
npm run build  # FAILED - CLI package empty
npm run test   # Parser: 126 passing, Core: 145 passing, CLI: FAILED (no tests)
npm run lint   # PASSED
grep -ri "turboshovel" packages/  # Found 9 matches in source, 2 in dist
grep -ri "runbooks" packages/     # Found references in CLI dist (stale) and test fixtures
```

**Files with blocking issues:**
- `packages/core/src/index.ts` - Line 1: `@turboshovel/shared` comment
- `packages/core/src/types.ts` - Line 65: `TurboshovelConfig` interface name
- `packages/core/__tests__/cli/output.test.ts` - Lines 10-11: duplicate import; Lines 54,58,65,74: wrong path in test fixtures
